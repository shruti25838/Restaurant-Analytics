# Restaurant Analytics

A centralized analytics platform for restaurant transactional data: normalized storage, business KPI computation, and demand prediction. Built with Python, SQL, and time-series ML.

## Problem

Small and mid-sized restaurants produce large amounts of daily data (orders, payments, menu items, visits) but rarely have a single place to measure performance. This project provides an end-to-end pipeline that:

- Stores normalized data in a relational database (3NF)
- Computes 10+ business KPIs automatically
- Supports time-series sales analysis
- Predicts future revenue with SARIMA and Prophet
- Exports BI-ready dashboards and Excel reports

## Features

| Feature | Description |
|---------|-------------|
| Normalized schema | 3NF database with referential integrity, indexes, and constraints |
| ETL pipeline | CSV ingestion with validation, deduplication, and timestamp normalization |
| Business KPIs | Daily/weekly/monthly revenue, AOV, peak hours, category analysis, and more |
| Demand prediction | SARIMA and Prophet with train/test evaluation (MAE, RMSE, MAPE) |
| SQL analytics | KPI views, time-series grouping, window functions |
| Excel export | Multi-sheet KPI workbook |
| Unit tests | 43 pytest tests for validators, transformers, and KPI calculators |
| SOLID design | Protocol-based abstractions, single-responsibility modules, extensible KPIs |

## Tech Stack

- **Python** — Pandas, SQLAlchemy, Prophet, Statsmodels
- **SQL** — PostgreSQL / SQLite (schema, views, indexes)
- **ML** — SARIMA, Prophet (time-series forecasting)
- **Testing** — pytest (43 tests)
- **Visualization** — Matplotlib, Jupyter
- **Data** — Kaggle-style restaurant dataset (5,000 orders, 12,895 line items)

## Project Structure

```
restaurant-analytics/
|
|-- data/
|   |-- raw/                  # Source CSVs (generated by pipeline)
|   |-- staging/              # Enriched order detail table
|   |-- warehouse/            # KPI outputs, Excel report, SQLite DB
|
|-- sql/
|   |-- schema/               # CREATE TABLE statements (PostgreSQL + SQLite)
|   |-- views/                # KPI views, sales trend views
|   |-- indexes.sql           # Performance indexes
|
|-- src/
|   |-- config/
|   |   |-- db_config.py      # Database connection (env-based)
|   |
|   |-- models/               # Data classes (Customer, Order, MenuItem)
|   |
|   |-- services/
|   |   |-- data_loader.py    # Repository pattern for DB access
|   |   |-- validator.py      # Data validation (null checks, required cols)
|   |   |-- transformer.py   # Timestamp normalization, deduplication
|   |   |-- kpi_calculator.py # KPI classes (SOLID, protocol-based)
|   |   |-- sample_data_generator.py
|   |
|   |-- views/
|   |   |-- sql_views.py      # Apply SQL views to database
|   |   |-- export_excel.py   # Multi-sheet Excel export
|   |
|   |-- pipeline.py           # Main ETL orchestrator
|
|-- tests/                    # 43 unit tests
|   |-- test_validator.py
|   |-- test_transformer.py
|   |-- test_kpi_calculator.py
|   |-- test_export_excel.py
|
|-- notebooks/
|   |-- 01_data_validation.ipynb
|   |-- 02_sql_analysis.ipynb
|   |-- 03_dashboard_metrics.ipynb
|   |-- 04_prediction_forecasting.ipynb
|
|-- airflow/
|   |-- daily_etl_dag.py      # Optional Airflow DAG
|
|-- requirements.txt
|-- README.md
```

## Quick Start

### 1. Clone and install

```bash
git clone https://github.com/<your-username>/restaurant-analytics.git
cd restaurant-analytics
pip install -r requirements.txt
```

### 2. Generate sample data

```bash
python -m src.services.sample_data_generator
```

This creates 5,000 orders with 12,895 line items across 45 menu items and 6 categories in `data/raw/`.

### 3. Run the pipeline

```bash
python -m src.pipeline
```

This will validate and transform raw CSVs, compute KPI tables, export `data/warehouse/kpi_report.xlsx`, and load data into a local SQLite database.

### 4. Run tests

```bash
python -m pytest tests/ -v
```

### 5. Open notebooks

```bash
jupyter notebook notebooks/
```

## Business KPIs

| KPI | Description |
|-----|-------------|
| Daily Revenue | Revenue aggregated by date |
| Weekly Revenue | Revenue grouped by ISO week |
| Monthly Revenue | Revenue grouped by year-month |
| Average Order Value | Mean revenue per order |
| Orders Per Day | Unique order count by date |
| Revenue Per Hour | Hourly revenue distribution |
| Peak Hours | Busiest hours ranked by order count |
| Weekday vs Weekend | Revenue and order split |
| Top Menu Items | Items ranked by revenue and quantity |
| Revenue by Category | Category-level revenue breakdown |

## Prediction and Forecasting

The `04_prediction_forecasting.ipynb` notebook implements:

| Model | Approach |
|-------|----------|
| Baseline | 7-day moving average |
| SARIMA(1,1,1)(1,1,0,7) | Seasonal ARIMA with weekly seasonality |
| Prophet | Additive model with trend and seasonality |

Models are evaluated on a 30-day held-out test set using MAE, RMSE, and MAPE. The chosen model produces a 7-day revenue forecast with confidence intervals.

## Database Configuration

The pipeline uses a local SQLite database at `data/warehouse/restaurant.db` by default. For PostgreSQL:

```bash
export DATABASE_URL="postgresql+psycopg2://user:pass@host:5432/dbname"
```

## SOLID Principles

- **Single Responsibility** — One role per module (validator, transformer, KPI calculator).
- **Open/Closed** — New KPIs extend the `KPIBase` protocol without changing existing code.
- **Liskov Substitution** — Any `KPIBase` implementation works with `run_kpi()`.
- **Interface Segregation** — Separate protocols for `DataRepository`, `Validator`, `KPIBase`.
- **Dependency Inversion** — Pipeline depends on abstractions (e.g. `DataRepository`), not concrete DB engines.

## Tests

```bash
# All tests
python -m pytest tests/ -v

# Single module
python -m pytest tests/test_kpi_calculator.py -v
```

## Dataset

Sample data is produced by `src/services/sample_data_generator.py`, inspired by:

- [Restaurant Sales Report](https://www.kaggle.com/datasets/rajatsurana979/restaurant-sales-report) (Kaggle)
- [Coffee Shop Sales](https://www.kaggle.com/datasets/dieterholger/coffee-shop-sales) (Kaggle)

## License

MIT
